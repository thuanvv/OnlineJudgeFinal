(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{303:function(a,s,t){"use strict";t.r(s);var e=t(14),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"安装维护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装维护"}},[a._v("#")]),a._v(" 安装维护")]),a._v(" "),s("h2",{attrs:{id:"🍷-准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🍷-准备工作"}},[a._v("#")]),a._v(" 🍷 准备工作")]),a._v(" "),s("ol",[s("li",[a._v("安装"),s("code",[a._v("docker")]),a._v("；"),s("a",{attrs:{href:"https://yeasy.gitbook.io/docker_practice/install/ubuntu#shi-yong-jiao-ben-zi-dong-an-zhuang",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考文档"),s("OutboundLink")],1)])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-fsSL")]),a._v(" https://get.docker.com "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mirror")]),a._v(" Aliyun\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl start "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("安装"),s("code",[a._v("docker-compose")]),a._v("；"),s("a",{attrs:{href:"https://yeasy.gitbook.io/docker_practice/compose/install",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考文档"),s("OutboundLink")],1)])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("-"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /usr/local/bin/docker-compose\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/docker-compose\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" /usr/local/bin/docker-compose /usr/bin/docker-compose\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" version\n")])])]),s("h2",{attrs:{id:"🔨-部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔨-部署"}},[a._v("#")]),a._v(" 🔨 部署")]),a._v(" "),s("p",[a._v("获取最新部署脚本（也可以自行前往网页下载）：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-b")]),a._v(" deploy https://github.com/winterant/OnlineJudge.git\n")])])]),s("p",[a._v("启动服务：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" OnlineJudge\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])])]),s("ul",[s("li",[a._v("访问首页"),s("code",[a._v("http://ip:8080")]),a._v("；可在宿主机"),s("RouterLink",{attrs:{to:"/deploy/network.html"}},[a._v("配置域名")]),a._v("；")],1),a._v(" "),s("li",[a._v("默认管理员用户："),s("code",[a._v("admin")]),a._v("，默认密码"),s("code",[a._v("adminadmin")]),a._v("，务必更改默认密码；")])]),a._v(" "),s("h2",{attrs:{id:"🚗-升级-web端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🚗-升级-web端"}},[a._v("#")]),a._v(" 🚗 升级(Web端)")]),a._v(" "),s("ul",[s("li",[s("p",[s("strong",[a._v("版本内更新")]),a._v("；版本号不变，无须修改任何配置，一般涉及一些影响较小的bug修复。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" pull web\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("跨版本升级")]),a._v("；版本号改变，一般涉及新功能的开发或重大bug的修复。跨版本升级的原理是将"),s("code",[a._v("docker-compose.yml")]),a._v(","),s("code",[a._v("lduoj.conf")]),a._v("更新为"),s("a",{attrs:{href:"https://github.com/winterant/OnlineJudge/tree/deploy",target:"_blank",rel:"noopener noreferrer"}},[a._v("最新部署脚本"),s("OutboundLink")],1),a._v("。\n随着版本的迭代升级，"),s("a",{attrs:{href:"https://github.com/winterant/OnlineJudge/tree/deploy",target:"_blank",rel:"noopener noreferrer"}},[a._v("最新部署脚本"),s("OutboundLink")],1),a._v("中某些配置项可能会发生变动，不过这种情况很少出现。"),s("strong",[a._v("大多数情况下，仅仅只需要手动修改一下"),s("code",[a._v("docker-compose.yml")]),a._v("中的"),s("code",[a._v("winterant/lduoj")]),a._v("的版本号")]),a._v("。如果您的版本落后于官方版本很多或不清楚部署脚本需要做哪些改动，那么建议您人工对比一下本地部署脚本和"),s("a",{attrs:{href:"https://github.com/winterant/OnlineJudge/tree/deploy",target:"_blank",rel:"noopener noreferrer"}},[a._v("最新部署脚本"),s("OutboundLink")],1),a._v("的差异，自行修改。")]),a._v(" "),s("ol",[s("li",[a._v("升级之前，最好先停止服务（理论上不停止服务也没事）：")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" down\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("修改"),s("code",[a._v("docker-compose.yml")]),a._v("中"),s("code",[a._v("winterant/lduoj")]),a._v("版本号为最新；同时，按上述说法修改其它变动(如有)；")]),a._v(" "),s("li",[a._v("拉取最新镜像并重新启动服务即可：")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" pull web  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 拉取最新镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])])])])]),a._v(" "),s("h2",{attrs:{id:"💿-备份-迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#💿-备份-迁移"}},[a._v("#")]),a._v(" 💿 备份/迁移")]),a._v(" "),s("h3",{attrs:{id:"备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[a._v("#")]),a._v(" 备份")]),a._v(" "),s("ol",[s("li",[a._v("将"),s("code",[a._v("docker-compose.yml")]),a._v("所在文件夹打包备份；"),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-cf")]),a._v(" - ./OnlineJudge "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" pigz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("nproc"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" OnlineJudge_bak.tar.gz\n")])])])])]),a._v(" "),s("h3",{attrs:{id:"恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复"}},[a._v("#")]),a._v(" 恢复")]),a._v(" "),s("ol",[s("li",[a._v("解压备份包"),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" OnlineJudge_bak.tar.gz\n")])])])]),a._v(" "),s("li",[a._v("一键部署"),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" OnlineJudge_bak\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);